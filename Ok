-- SUPER SMOOTH UI LIBRARY - FIXED ALL ERRORS + MOBILE & PC SUPPORT
-- Chủ đề Đen Trắng cực đẹp, animation mượt, không lỗi nil Indicator
-- Toggle bằng INSERT (PC) hoặc nút nổi (Mobile)

local Library = {}
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local CoreGui = game:GetService("CoreGui")

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "SuperUILib_V2"
ScreenGui.ResetOnSpawn = false
ScreenGui.DisplayOrder = 999
ScreenGui.Parent = CoreGui

local Theme = {
    Bg1 = Color3.fromRGB(12, 12, 12),
    Bg2 = Color3.fromRGB(28, 28, 28),
    Dark = Color3.fromRGB(8, 8, 8),
    Gray = Color3.fromRGB(55, 55, 55),
    Accent = Color3.fromRGB(255, 255, 255),
    Text = Color3.fromRGB(230, 230, 230),
    Mute = Color3.fromRGB(140, 140, 140)
}

-- Helper
local function Corner(parent, radius)
    local c = Instance.new("UICorner")
    c.CornerRadius = UDim.new(0, radius or 8)
    c.Parent = parent
end

local function Stroke(parent, color, thick)
    local s = Instance.new("UIStroke")
    s.Color = color or Theme.Accent
    s.Thickness = thick or 1
    s.Transparency = 0.6
    s.Parent = parent
end

local function Gradient(parent, c1, c2, rot)
    local g = Instance.new("UIGradient")
    g.Color = ColorSequence.new(c1, c2)
    g.Rotation = rot or 90
    g.Parent = parent
end

local function Tween(obj, prop)
    TweenService:Create(obj, TweenInfo.new(0.25, Enum.EasingStyle.Quart), prop):Play()
end

-- Mobile Toggle Button
local MobileToggle = Instance.new("TextButton")
MobileToggle.Size = UDim2.new(0, 60, 0, 60)
MobileToggle.Position = UDim2.new(0, 20, 1, -80)
MobileToggle.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
MobileToggle.Text = "≡"
MobileToggle.TextColor3 = Color3.new(1,1,1)
MobileToggle.TextSize = 30
MobileToggle.Font = Enum.Font.GothamBold
MobileToggle.Visible = UserInputService.TouchEnabled
MobileToggle.Parent = ScreenGui
Corner(MobileToggle, 20)
Stroke(MobileToggle)

function Library:CreateWindow(config)
    config = config or {}
    local winName = config.Name or "Executor"
    local size = config.Size or {700, 500}

    local Window = {}
    local Main = Instance.new("Frame")
    Main.Size = UDim2.new(0, size[1], 0, size[2])
    Main.Position = UDim2.new(0.5, -size[1]/2, 0.5, -size[2]/2)
    Main.BackgroundColor3 = Theme.Bg1
    Main.ClipsDescendants = true
    Main.Parent = ScreenGui
    Corner(Main, 16)
    Stroke(Main)

    -- Shadow
    local Shadow = Instance.new("ImageLabel")
    Shadow.Size = UDim2.new(1, 50, 1, 50)
    Shadow.Position = UDim2.new(0, -25, 0, -25)
    Shadow.BackgroundTransparency = 1
    Shadow.Image = "rbxassetid://6014261993"
    Shadow.ImageColor3 = Color3.new(0,0,0)
    Shadow.ImageTransparency = 0.6
    Shadow.ScaleType = Enum.ScaleType.Slice
    Shadow.SliceCenter = Rect.new(50,50,450,450)
    Shadow.ZIndex = -1
    Shadow.Parent = Main

    Gradient(Main, Theme.Bg1, Theme.Bg2, 135)

    -- Header
    local Header = Instance.new("Frame")
    Header.Size = UDim2.new(1, 0, 0, 50)
    Header.BackgroundColor3 = Theme.Dark
    Header.Parent = Main
    Corner(Header, 16)

    local Title = Instance.new("TextLabel")
    Title.Size = UDim2.new(1, -120, 1, 0)
    Title.Position = UDim2.new(0, 20, 0, 0)
    Title.BackgroundTransparency = 1
    Title.Text = winName
    Title.TextColor3 = Theme.Accent
    Title.TextSize = 18
    Title.Font = Enum.Font.GothamBold
    Title.TextXAlignment = Enum.TextXAlignment.Left
    Title.Parent = Header

    -- Buttons
    local Minimize = Instance.new("TextButton")
    Minimize.Size = UDim2.new(0, 35, 0, 35)
    Minimize.Position = UDim2.new(1, -80, 0.5, -17)
    Minimize.BackgroundColor3 = Theme.Gray
    Minimize.Text = "−"
    Minimize.TextColor3 = Theme.Accent
    Minimize.Font = Enum.Font.GothamBold
    Minimize.Parent = Header
    Corner(Minimize, 8)

    local Close = Instance.new("TextButton")
    Close.Size = Minimize.Size
    Close.Position = UDim2.new(1, -40, 0.5, -17)
    Close.BackgroundColor3 = Color3.fromRGB(220, 60, 60)
    Close.Text = "×"
    Close.TextColor3 = Theme.Accent
    Close.Font = Enum.Font.GothamBold
    Close.Parent = Header
    Corner(Close, 8)

    -- Tab Container
    local TabContainer = Instance.new("Frame")
    local TabLayout = Instance.new("UIListLayout")
    TabLayout.FillDirection = Enum.FillDirection.Horizontal
    TabLayout.Padding = UDim.new(0, 8)
    TabLayout.Parent = Instance.new("Frame", Main)
    TabLayout.Parent.Size = UDim2.new(1, -20, 0, 40)
    TabLayout.Parent.Position = UDim2.new(0, 10, 0, 55)
    TabLayout.Parent.BackgroundTransparency = 1
    TabLayout.Parent.Parent = Main

    local Content = Instance.new("Frame")
    Content.Size = UDim2.new(1, -20, 1, -110)
    Content.Position = UDim2.new(0, 10, 0, 100)
    Content.BackgroundTransparency = 1
    Content.Parent = Main

    local dragging = false
    local dragInput, dragStart, startPos

    local function updateInput(input)
        if dragging then
            local delta = input.Position - dragStart
            Main.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        end
    end

    Header.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPos = Main.Position

            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)

    Header.InputChanged:Connect(updateInput)
    UserInputService.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
            updateInput(input)
        end
    end)

    local minimized = false
    Minimize.MouseButton1Click:Connect(function()
        minimized = not minimized
        Tween(Main, {Size = minimized and UDim2.new(0, size[1], 0, 50) or UDim2.new(0, size[1], 0, size[2])})
        Content.Visible = not minimized
        TabLayout.Parent.Visible = not minimized
    end)

    Close.MouseButton1Click:Connect(function() Main:Destroy() end)

    MobileToggle.MouseButton1Click:Connect(function()
        ScreenGui.Enabled = not ScreenGui.Enabled
    end)

    local ActiveTabContent = nil

    function Window:CreateTab(name)
        local Tab = {}

        local TabBtn = Instance.new("TextButton")
        TabBtn.Size = UDim2.new(0, 130, 1, -10)
        TabBtn.BackgroundColor3 = Theme.Dark
        TabBtn.Text = name
        TabBtn.TextColor3 = Theme.Text
        TabBtn.Font = Enum.Font.GothamSemibold
        TabBtn.TextSize = 15
        TabBtn.Parent = TabLayout.Parent
        Corner(TabBtn, 10)
        Stroke(TabBtn, Theme.Gray)

        local Indicator = Instance.new("Frame")
        Indicator.Size = UDim2.new(1, 0, 0, 4)
        Indicator.Position = UDim2.new(0, 0, 1, -4)
        Indicator.BackgroundColor3 = Theme.Accent
        Indicator.Visible = false
        Indicator.Parent = TabBtn

        local TabContent = Instance.new("ScrollingFrame")
        TabContent.Size = UDim2.new(1, 0, 1, 0)
        TabContent.BackgroundTransparency = 1
        TabContent.ScrollBarThickness = 4
        TabContent.Visible = false
        TabContent.CanvasSize = UDim2.new(0,0,0,0)
        TabContent.Parent = Content

        local List = Instance.new("UIListLayout")
        List.Padding = UDim.new(0, 10)
        List.Parent = TabContent
        List:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
            TabContent.CanvasSize = UDim2.new(0,0,0, List.AbsoluteContentSize.Y + 20)
        end)

        local function Open()
            if ActiveTabContent and ActiveTabContent ~= TabContent then
                ActiveTabContent.Visible = false
                if ActiveTabContent.Parent:FindFirstChild("Indicator") then
                    ActiveTabContent.Parent.Indicator.Visible = false
                end
            end
            TabContent.Visible = true
            Indicator.Visible = true
            ActiveTabContent = TabContent
            Tween(TabBtn, {BackgroundColor3 = Theme.Gray})
        end

        TabBtn.MouseButton1Click:Connect(Open)
        TabBtn.MouseEnter:Connect(function() if not Indicator.Visible then Tween(TabBtn, {BackgroundColor3 = Theme.Gray}) end end)
        TabBtn.MouseLeave:Connect(function() if not Indicator.Visible then Tween(TabBtn, {BackgroundColor3 = Theme.Dark}) end end)

        if not ActiveTabContent then Open() end

        function Tab:AddSection(secName)
            local Section = {}
            local SecFrame = Instance.new("Frame")
            SecFrame.Size = UDim2.new(1, -20, 0, 60)
            SecFrame.BackgroundColor3 = Theme.Dark
            SecFrame.Parent = TabContent
            Corner(SecFrame, 12)
            Stroke(SecFrame)

            local SecTitle = Instance.new("TextLabel")
            SecTitle.Text = secName
            SecTitle.TextColor3 = Theme.Accent
            SecTitle.Font = Enum.Font.GothamBold
            SecTitle.TextSize = 16
            SecTitle.BackgroundTransparency = 1
            SecTitle.Position = UDim2.new(0, 15, 0, 8)
            SecTitle.Size = UDim2.new(1, -30, 0, 30)
            SecTitle.Parent = SecFrame

            local Container = Instance.new("Frame")
            Container.Size = UDim2.new(1, -20, 1, -45)
            Container.Position = UDim2.new(0, 10, 0, 35)
            Container.BackgroundTransparency = 1
            Container.Parent = SecFrame

            local SecList = Instance.new("UIListLayout")
            SecList.Padding = UDim.new(0, 8)
            SecList.Parent = Container

            function Section:AddButton(text, callback)
                local Btn = Instance.new("TextButton")
                Btn.Size = UDim2.new(1, 0, 0, 40)
                Btn.BackgroundColor3 = Theme.Bg2
                Btn.Text = "  " .. text
                Btn.TextColor3 = Theme.Text
                Btn.TextXAlignment = "Left"
                Btn.Font = Enum.Font.Gotham
                Btn.Parent = Container
                Corner(Btn, 10)
                Stroke(Btn, Theme.Gray)

                Btn.MouseButton1Click:Connect(function()
                    Tween(Btn, {Size = UDim2.new(1, -6, 0, 38)})
                    task.wait(0.1)
                    Tween(Btn, {Size = UDim2.new(1, 0, 0, 40)})
                    callback()
                end)

                Btn.MouseEnter:Connect(function() Tween(Btn, {BackgroundColor3 = Theme.Gray}) end)
                Btn.MouseLeave:Connect(function() Tween(Btn, {BackgroundColor3 = Theme.Bg2}) end)
            end

            function Section:AddToggle(text, default, callback)
                default = default or false
                local Toggle = {Value = default}
                local Frame = Instance.new("Frame")
                Frame.Size = UDim2.new(1, 0, 0, 42)
                Frame.BackgroundTransparency = 1
                Frame.Parent = SecContent

                local Label = Instance.new("TextLabel")
                Label.Size = UDim2.new(1, -70, 1, 0)
                Label.Position = UDim2.new(0, 15, 0, 0)
                Label.BackgroundTransparency = 1
                Label.Text = text
                Label.TextColor3 = Theme.Text
                Label.TextSize = 14
                Label.Font = Enum.Font.Gotham
                Label.TextXAlignment = Enum.TextXAlignment.Left
                Label.Parent = Frame

                local SwitchBg = Instance.new("Frame")
                SwitchBg.Size = UDim2.new(0, 50, 0, 24)
                SwitchBg.Position = UDim2.new(1, -65, 0.5, -12)
                SwitchBg.BackgroundColor3 = Theme.Dark
                SwitchBg.BorderSizePixel = 0
                MakeCorner(SwitchBg, 12)
                SwitchBg.Parent = Frame
                MakeStroke(SwitchBg, Theme.Gray, 1.2)

                local SwitchKnob = Instance.new("Frame")
                SwitchKnob.Size = UDim2.new(0, 20, 0, 20)
                SwitchKnob.Position = UDim2.new(0, 2, 0.5, -10)
                SwitchKnob.BackgroundColor3 = Theme.MuteText
                SwitchKnob.BorderSizePixel = 0
                MakeCorner(SwitchKnob, 10)
                SwitchKnob.Parent = SwitchBg

                local function Set(state)
                    Toggle.Value = state
                    if state then
                        Tween(SwitchBg, TweenInfo.new(0.25, Enum.EasingStyle.Quint), {BackgroundColor3 = Theme.Accent})
                        Tween(SwitchKnob, TweenInfo.new(0.25, Enum.EasingStyle.Quint), {Position = UDim2.new(1, -22, 0.5, -10), BackgroundColor3 = Theme.Accent})
                    else
                        Tween(SwitchBg, TweenInfo.new(0.25, Enum.EasingStyle.Quint), {BackgroundColor3 = Theme.Dark})
                        Tween(SwitchKnob, TweenInfo.new(0.25, Enum.EasingStyle.Quint), {Position = UDim2.new(0, 2, 0.5, -10), BackgroundColor3 = Theme.MuteText})
                    end
                    callback(state)
                end

                SwitchBg.InputBegan:Connect(function(inp)
                    if inp.UserInputType == Enum.UserInputType.MouseButton1 then
                        Set(not Toggle.Value)
                    end
                end)

                if default then Set(true) end
                return Toggle
            end
            

            return Section
        end

        return Tab
    end

    return Window
end

-- Toggle UI bằng Insert (PC)
UserInputService.InputBegan:Connect(function(i, gp)
    if not gp and i.KeyCode == Enum.KeyCode.Insert then
        ScreenGui.Enabled = not ScreenGui.Enabled
    end
end)

return Library
