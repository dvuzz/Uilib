-- ULTRA UI LIB V3 - ĐẸP LUNG LINH, MƯỢT MÀ, FULL ELEMENTS
-- Theme Đen Trắng Hòa Quyện: Gradient, Glow, Shadow Pro
-- Hỗ trợ Mobile/PC Full, No Lag, No Error

local Library = {}
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local CoreGui = game:GetService("CoreGui")

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "UltraUILib_V3"
ScreenGui.ResetOnSpawn = false
ScreenGui.DisplayOrder = 1000
ScreenGui.Parent = CoreGui

local Theme = {
    Primary = Color3.fromRGB(10, 10, 10),  -- Đen chính
    Secondary = Color3.fromRGB(25, 25, 25),  -- Đen nhạt
    Accent = Color3.fromRGB(255, 255, 255),  -- Trắng
    Text = Color3.fromRGB(220, 220, 220),  -- Văn bản sáng
    Mute = Color3.fromRGB(150, 150, 150),  -- Mờ
    Glow = Color3.fromRGB(200, 200, 200),  -- Glow trắng
    Shadow = Color3.fromRGB(0, 0, 0)  -- Bóng đen
}

-- Helpers
local function CreateCorner(parent, radius)
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, radius or 6)
    corner.Parent = parent
end

local function CreateStroke(parent, color, thick, trans)
    local stroke = Instance.new("UIStroke")
    stroke.Color = color or Theme.Accent
    stroke.Thickness = thick or 1
    stroke.Transparency = trans or 0.7
    stroke.Parent = parent
end

local function CreateGradient(parent, c1, c2, rot)
    local grad = Instance.new("UIGradient")
    grad.Color = ColorSequence.new(c1, c2)
    grad.Rotation = rot or 45
    grad.Parent = parent
end

local function Tween(obj, props, info)
    TweenService:Create(obj, info or TweenInfo.new(0.3, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), props):Play()
end

-- Mobile Toggle Button
local isMobile = UserInputService.TouchEnabled
local MobileBtn = Instance.new("TextButton")
MobileBtn.Size = UDim2.new(0, 50, 0, 50)
MobileBtn.Position = UDim2.new(1, -70, 1, -70)
MobileBtn.BackgroundColor3 = Theme.Secondary
MobileBtn.Text = "UI"
MobileBtn.TextColor3 = Theme.Accent
MobileBtn.TextSize = 20
MobileBtn.Visible = isMobile
MobileBtn.Parent = ScreenGui
CreateCorner(MobileBtn, 25)
CreateStroke(MobileBtn, Theme.Glow, 1.5, 0.5)

MobileBtn.MouseButton1Click:Connect(function()
    ScreenGui.Enabled = not ScreenGui.Enabled
end)

function Library:CreateWindow(options)
    options = options or {}
    local title = options.Name or "Ultra Executor"
    local sizeX, sizeY = options.SizeX or 600, options.SizeY or 400

    local Window = {}
    local MainFrame = Instance.new("Frame")
    MainFrame.Size = UDim2.new(0, sizeX, 0, sizeY)
    MainFrame.Position = UDim2.new(0.5, -sizeX/2, 0.5, -sizeY/2)
    MainFrame.BackgroundColor3 = Theme.Primary
    MainFrame.ClipsDescendants = true
    MainFrame.Parent = ScreenGui
    CreateCorner(MainFrame, 12)
    CreateStroke(MainFrame, Theme.Glow, 1, 0.4)
    CreateGradient(MainFrame, Theme.Primary, Theme.Secondary, 135)

    -- Shadow
    local Shadow = Instance.new("Frame")
    Shadow.Size = UDim2.new(1, 30, 1, 30)
    Shadow.Position = UDim2.new(0, -15, 0, -15)
    Shadow.BackgroundColor3 = Theme.Shadow
    Shadow.BackgroundTransparency = 0.7
    Shadow.ZIndex = -1
    CreateCorner(Shadow, 20)
    Shadow.Parent = MainFrame

    -- Header
    local Header = Instance.new("Frame")
    Header.Size = UDim2.new(1, 0, 0, 50)
    Header.BackgroundTransparency = 1
    Header.Parent = MainFrame

    local HeaderBg = Instance.new("Frame")
    HeaderBg.Size = UDim2.new(1, 0, 1, 0)
    HeaderBg.BackgroundColor3 = Theme.Secondary
    HeaderBg.Parent = Header
    CreateCorner(HeaderBg, 12)
    CreateGradient(HeaderBg, Theme.Secondary, Theme.Primary, 90)

    local TitleLabel = Instance.new("TextLabel")
    TitleLabel.Size = UDim2.new(1, -100, 1, 0)
    TitleLabel.Position = UDim2.new(0, 15, 0, 0)
    TitleLabel.BackgroundTransparency = 1
    TitleLabel.Text = title
    TitleLabel.TextColor3 = Theme.Accent
    TitleLabel.TextSize = 18
    TitleLabel.Font = Enum.Font.ArialBold
    TitleLabel.TextXAlignment = Enum.TextXAlignment.Left
    TitleLabel.Parent = Header

    -- Minimize & Close
    local MinBtn = Instance.new("TextButton")
    MinBtn.Size = UDim2.new(0, 30, 0, 30)
    MinBtn.Position = UDim2.new(1, -70, 0.5, -15)
    MinBtn.BackgroundColor3 = Theme.Mute
    MinBtn.Text = "-"
    MinBtn.TextColor3 = Theme.Accent
    MinBtn.Font = Enum.Font.ArialBold
    MinBtn.Parent = Header
    CreateCorner(MinBtn, 8)
    CreateStroke(MinBtn, Theme.Glow, 1)

    local CloseBtn = Instance.new("TextButton")
    CloseBtn.Size = UDim2.new(0, 30, 0, 30)
    CloseBtn.Position = UDim2.new(1, -35, 0.5, -15)
    CloseBtn.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
    CloseBtn.Text = "X"
    CloseBtn.TextColor3 = Theme.Accent
    CloseBtn.Font = Enum.Font.ArialBold
    CloseBtn.Parent = Header
    CreateCorner(CloseBtn, 8)
    CreateStroke(CloseBtn, Theme.Glow, 1)

    -- Tab Bar
    local TabBar = Instance.new("Frame")
    TabBar.Size = UDim2.new(1, -20, 0, 40)
    TabBar.Position = UDim2.new(0, 10, 0, 55)
    TabBar.BackgroundColor3 = Theme.Secondary
    TabBar.Parent = MainFrame
    CreateCorner(TabBar, 10)
    CreateStroke(TabBar, Theme.Mute)

    local TabLayout = Instance.new("UIListLayout")
    TabLayout.FillDirection = Enum.FillDirection.Horizontal
    TabLayout.Padding = UDim.new(0, 10)
    TabLayout.VerticalAlignment = Enum.VerticalAlignment.Center
    TabLayout.Parent = TabBar

    -- Content
    local Content = Instance.new("Frame")
    Content.Size = UDim2.new(1, -20, 1, -105)
    Content.Position = UDim2.new(0, 10, 0, 100)
    Content.BackgroundTransparency = 1
    Content.Parent = MainFrame

    local ActiveTab = nil

    -- Dragging (Support Mobile/PC)
    local dragging, dragStart, startPos
    local function UpdateDrag(input)
        local delta = input.Position - dragStart
        MainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end

    Header.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPos = MainFrame.Position
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)

    UserInputService.InputChanged:Connect(function(input)
        if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
            UpdateDrag(input)
        end
    end)

    -- Minimize/Close
    local minState = false
    MinBtn.MouseButton1Click:Connect(function()
        minState = not minState
        Tween(MainFrame, {Size = minState and UDim2.new(0, sizeX, 0, 50) or UDim2.new(0, sizeX, 0, sizeY)})
        Content.Visible = not minState
        TabBar.Visible = not minState
        MinBtn.Text = minState and "+" or "-"
    end)

    CloseBtn.MouseButton1Click:Connect(function()
        MainFrame:Destroy()
    end)

    -- Create Tab
    function Window:CreateTab(name, icon)
        local Tab = {}
        local TabBtn = Instance.new("TextButton")
        TabBtn.Size = UDim2.new(0, 120, 1, -10)
        TabBtn.BackgroundColor3 = Theme.Secondary
        TabBtn.Text = (icon or "") .. " " .. name
        TabBtn.TextColor3 = Theme.Mute
        TabBtn.Font = Enum.Font.Arial
        TabBtn.TextSize = 14
        TabBtn.Parent = TabBar
        CreateCorner(TabBtn, 8)
        CreateStroke(TabBtn, Theme.Glow, 1, 0.8)

        local Indicator = Instance.new("Frame")
        Indicator.Size = UDim2.new(1, 0, 0, 3)
        Indicator.Position = UDim2.new(0, 0, 1, 0)
        Indicator.BackgroundColor3 = Theme.Accent
        Indicator.BackgroundTransparency = 1
        Indicator.Parent = TabBtn
        CreateGradient(Indicator, Theme.Accent, Theme.Glow)

        local TabContent = Instance.new("ScrollingFrame")
        TabContent.Size = UDim2.new(1, 0, 1, 0)
        TabContent.BackgroundTransparency = 1
        TabContent.ScrollBarThickness = 3
        TabContent.ScrollBarImageColor3 = Theme.Mute
        TabContent.Visible = false
        TabContent.Parent = Content

        local ContentLayout = Instance.new("UIListLayout")
        ContentLayout.Padding = UDim.new(0, 8)
        ContentLayout.Parent = TabContent
        ContentLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
            TabContent.CanvasSize = UDim2.new(0, 0, 0, ContentLayout.AbsoluteContentSize.Y + 20)
        end)

        local function Activate()
            if ActiveTab then
                ActiveTab.Visible = false
                local oldBtn = TabBar:FindFirstChild(ActiveTab.Name:gsub("Content", "Btn"))
                if oldBtn then
                    Tween(oldBtn.TextLabel or oldBtn, {TextColor3 = Theme.Mute})
                    Tween(oldBtn.Indicator, {BackgroundTransparency = 1})
                end
            end
            TabContent.Visible = true
            ActiveTab = TabContent
            Tween(TabBtn, {TextColor3 = Theme.Accent})
            Tween(Indicator, {BackgroundTransparency = 0})
        end

        TabBtn.MouseButton1Click:Connect(Activate)
        TabBtn.MouseEnter:Connect(function()
            if not TabContent.Visible then Tween(TabBtn, {BackgroundColor3 = Theme.Mute}) end
        end)
        TabBtn.MouseLeave:Connect(function()
            if not TabContent.Visible then Tween(TabBtn, {BackgroundColor3 = Theme.Secondary}) end
        end)

        if not ActiveTab then Activate() end

        -- Section
        function Tab:AddSection(secName)
            local Section = {}
            local SecFrame = Instance.new("Frame")
            SecFrame.Size = UDim2.new(1, 0, 0, 40)
            SecFrame.BackgroundColor3 = Theme.Secondary
            SecFrame.Parent = TabContent
            CreateCorner(SecFrame, 10)
            CreateStroke(SecFrame, Theme.Glow, 1, 0.5)
            CreateGradient(SecFrame, Theme.Secondary, Theme.Primary)

            local SecTitle = Instance.new("TextLabel")
            SecTitle.Size = UDim2.new(1, -20, 0, 30)
            SecTitle.Position = UDim2.new(0, 10, 0, 5)
            SecTitle.BackgroundTransparency = 1
            SecTitle.Text = secName
            SecTitle.TextColor3 = Theme.Accent
            SecTitle.TextSize = 16
            SecTitle.Font = Enum.Font.ArialBold
            SecTitle.TextXAlignment = Enum.TextXAlignment.Left
            SecTitle.Parent = SecFrame

            local SecContent = Instance.new("Frame")
            SecContent.Size = UDim2.new(1, -20, 1, -35)
            SecContent.Position = UDim2.new(0, 10, 0, 35)
            SecContent.BackgroundTransparency = 1
            SecContent.Parent = SecFrame

            local SecLayout = Instance.new("UIListLayout")
            SecLayout.Padding = UDim.new(0, 6)
            SecLayout.Parent = SecContent
            SecLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
                SecFrame.Size = UDim2.new(1, 0, 0, SecLayout.AbsoluteContentSize.Y + 45)
            end)

            -- Button
            function Section:AddButton(text, callback)
                local Button = Instance.new("TextButton")
                Button.Size = UDim2.new(1, 0, 0, 35)
                Button.BackgroundColor3 = Theme.Primary
                Button.Text = text
                Button.TextColor3 = Theme.Text
                Button.Font = Enum.Font.Arial
                Button.TextSize = 14
                Button.Parent = SecContent
                CreateCorner(Button, 8)
                CreateStroke(Button, Theme.Accent, 1.2)

                Button.MouseButton1Click:Connect(function()
                    Tween(Button, {Size = UDim2.new(1, 0, 0, 32)}, TweenInfo.new(0.1, Enum.EasingStyle.Back))
                    wait(0.1)
                    Tween(Button, {Size = UDim2.new(1, 0, 0, 35)}, TweenInfo.new(0.1, Enum.EasingStyle.Back))
                    callback()
                end)
                Button.MouseEnter:Connect(function() Tween(Button, {BackgroundColor3 = Theme.Mute}) end)
                Button.MouseLeave:Connect(function() Tween(Button, {BackgroundColor3 = Theme.Primary}) end)
                return Button
            end

            -- Toggle
            function Section:AddToggle(text, default, callback)
                default = default or false
                local Toggle = {Value = default}
                local TogFrame = Instance.new("Frame")
                TogFrame.Size = UDim2.new(1, 0, 0, 35)
                TogFrame.BackgroundTransparency = 1
                TogFrame.Parent = SecContent

                local TogLabel = Instance.new("TextLabel")
                TogLabel.Size = UDim2.new(1, -60, 1, 0)
                TogLabel.Position = UDim2.new(0, 10, 0, 0)
                TogLabel.BackgroundTransparency = 1
                TogLabel.Text = text
                TogLabel.TextColor3 = Theme.Text
                TogLabel.Font = Enum.Font.Arial
                TogLabel.TextSize = 14
                TogLabel.TextXAlignment = Enum.TextXAlignment.Left
                TogLabel.Parent = TogFrame

                local TogSwitch = Instance.new("Frame")
                TogSwitch.Size = UDim2.new(0, 45, 0, 22)
                TogSwitch.Position = UDim2.new(1, -55, 0.5, -11)
                TogSwitch.BackgroundColor3 = Theme.Mute
                TogSwitch.Parent = TogFrame
                CreateCorner(TogSwitch, 11)
                CreateStroke(TogSwitch)

                local TogKnob = Instance.new("Frame")
                TogKnob.Size = UDim2.new(0, 18, 0, 18)
                TogKnob.Position = UDim2.new(0, 2, 0.5, -9)
                TogKnob.BackgroundColor3 = Theme.Accent
                TogKnob.Parent = TogSwitch
                CreateCorner(TogKnob, 9)

                local function SetToggle(state)
                    Toggle.Value = state
                    Tween(TogSwitch, {BackgroundColor3 = state and Theme.Accent or Theme.Mute})
                    Tween(TogKnob, {Position = state and UDim2.new(1, -20, 0.5, -9) or UDim2.new(0, 2, 0.5, -9)})
                    callback(state)
                end

                TogSwitch.MouseButton1Click:Connect(function() SetToggle(not Toggle.Value) end)
                if default then SetToggle(true) end
                return Toggle
            end

            -- Slider
            function Section:AddSlider(text, min, max, default, callback)
                default = math.clamp(default or min, min, max)
                local Slider = {Value = default}
                local SliderFrame = Instance.new("Frame")
                SliderFrame.Size = UDim2.new(1, 0, 0, 50)
                SliderFrame.BackgroundTransparency = 1
                SliderFrame.Parent = SecContent

                local SliderLabel = Instance.new("TextLabel")
                SliderLabel.Size = UDim2.new(1, 0, 0, 20)
                SliderLabel.Position = UDim2.new(0, 10, 0, 0)
                SliderLabel.BackgroundTransparency = 1
                SliderLabel.Text = text .. ": " .. default
                SliderLabel.TextColor3 = Theme.Text
                SliderLabel.Font = Enum.Font.Arial
                SliderLabel.TextSize = 14
                SliderLabel.TextXAlignment = Enum.TextXAlignment.Left
                SliderLabel.Parent = SliderFrame

                local SliderBg = Instance.new("Frame")
                SliderBg.Size = UDim2.new(1, -20, 0, 6)
                SliderBg.Position = UDim2.new(0, 10, 0, 30)
                SliderBg.BackgroundColor3 = Theme.Mute
                SliderBg.Parent = SliderFrame
                CreateCorner(SliderBg, 3)

                local SliderFill = Instance.new("Frame")
                SliderFill.Size = UDim2.new((default - min) / (max - min), 0, 1, 0)
                SliderFill.BackgroundColor3 = Theme.Accent
                SliderFill.Parent = SliderBg
                CreateCorner(SliderFill, 3)

                local dragSlider = false
                SliderBg.InputBegan:Connect(function(input)
                    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                        dragSlider = true
                    end
                end)
                UserInputService.InputEnded:Connect(function(input)
                    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                        dragSlider = false
                    end
                end)
                UserInputService.InputChanged:Connect(function(input)
                    if dragSlider and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
                        local perc = math.clamp((input.Position.X - SliderBg.AbsolutePosition.X) / SliderBg.AbsoluteSize.X, 0, 1)
                        local val = math.floor(min + (max - min) * perc)
                        Slider.Value = val
                        SliderLabel.Text = text .. ": " .. val
                        Tween(SliderFill, {Size = UDim2.new(perc, 0, 1, 0)})
                        callback(val)
                    end
                end)
                return Slider
            end

            -- Dropdown (New!)
            function Section:AddDropdown(text, options, default, callback)
                options = options or {}
                default = default or options[1]
                local Dropdown = {Value = default}
                local DropFrame = Instance.new("Frame")
                DropFrame.Size = UDim2.new(1, 0, 0, 35)
                DropFrame.BackgroundColor3 = Theme.Primary
                DropFrame.Parent = SecContent
                CreateCorner(DropFrame, 8)
                CreateStroke(DropFrame)

                local DropLabel = Instance.new("TextLabel")
                DropLabel.Size = UDim2.new(1, -40, 1, 0)
                DropLabel.Position = UDim2.new(0, 10, 0, 0)
                DropLabel.BackgroundTransparency = 1
                DropLabel.Text = text .. ": " .. default
                DropLabel.TextColor3 = Theme.Text
                DropLabel.Font = Enum.Font.Arial
                DropLabel.TextSize = 14
                DropLabel.TextXAlignment = Enum.TextXAlignment.Left
                DropLabel.Parent = DropFrame

                local DropArrow = Instance.new("TextLabel")
                DropArrow.Size = UDim2.new(0, 30, 1, 0)
                DropArrow.Position = UDim2.new(1, -35, 0, 0)
                DropArrow.BackgroundTransparency = 1
                DropArrow.Text = "▼"
                DropArrow.TextColor3 = Theme.Accent
                DropArrow.Parent = DropFrame

                local DropList = Instance.new("ScrollingFrame")
                DropList.Size = UDim2.new(1, 0, 0, 0)
                DropList.Position = UDim2.new(0, 0, 1, 0)
                DropList.BackgroundColor3 = Theme.Secondary
                DropList.Visible = false
                DropList.ScrollBarThickness = 2
                DropList.Parent = DropFrame
                CreateCorner(DropList, 8)
                CreateStroke(DropList)

                local DropLayout = Instance.new("UIListLayout")
                DropLayout.Padding = UDim.new(0, 4)
                DropLayout.Parent = DropList

                local open = false
                DropFrame.MouseButton1Click:Connect(function()
                    open = not open
                    Tween(DropList, {Size = open and UDim2.new(1, 0, 0, math.min(#options * 30, 120)) or UDim2.new(1, 0, 0, 0)})
                    DropList.Visible = open
                    Tween(DropArrow, {Rotation = open and 180 or 0})
                end)

                for _, opt in ipairs(options) do
                    local OptBtn = Instance.new("TextButton")
                    OptBtn.Size = UDim2.new(1, 0, 0, 25)
                    OptBtn.BackgroundTransparency = 1
                    OptBtn.Text = opt
                    OptBtn.TextColor3 = Theme.Text
                    OptBtn.Font = Enum.Font.Arial
                    OptBtn.TextSize = 13
                    OptBtn.Parent = DropList

                    OptBtn.MouseButton1Click:Connect(function()
                        Dropdown.Value = opt
                        DropLabel.Text = text .. ": " .. opt
                        callback(opt)
                        open = false
                        Tween(DropList, {Size = UDim2.new(1, 0, 0, 0)})
                        DropList.Visible = false
                        Tween(DropArrow, {Rotation = 0})
                    end)
                end

                return Dropdown
            end

            -- Keybind (New!)
            function Section:AddKeybind(text, default, callback)
                default = default or Enum.KeyCode.Unknown
                local Keybind = {Value = default}
                local KeyFrame = Instance.new("Frame")
                KeyFrame.Size = UDim2.new(1, 0, 0, 35)
                KeyFrame.BackgroundTransparency = 1
                KeyFrame.Parent = SecContent

                local KeyLabel = Instance.new("TextLabel")
                KeyLabel.Size = UDim2.new(1, -80, 1, 0)
                KeyLabel.Position = UDim2.new(0, 10, 0, 0)
                KeyLabel.BackgroundTransparency = 1
                KeyLabel.Text = text
                KeyLabel.TextColor3 = Theme.Text
                KeyLabel.Font = Enum.Font.Arial
                KeyLabel.TextSize = 14
                KeyLabel.TextXAlignment = Enum.TextXAlignment.Left
                KeyLabel.Parent = KeyFrame

                local KeyBtn = Instance.new("TextButton")
                KeyBtn.Size = UDim2.new(0, 70, 1, -6)
                KeyBtn.Position = UDim2.new(1, -80, 0.5, -12)
                KeyBtn.BackgroundColor3 = Theme.Primary
                KeyBtn.Text = default.Name
                KeyBtn.TextColor3 = Theme.Accent
                KeyBtn.Font = Enum.Font.Arial
                KeyBtn.Parent = KeyFrame
                CreateCorner(KeyBtn, 8)
                CreateStroke(KeyBtn)

                local binding = false
                KeyBtn.MouseButton1Click:Connect(function()
                    binding = true
                    KeyBtn.Text = "..."
                end)

                UserInputService.InputBegan:Connect(function(input)
                    if binding and input.UserInputType == Enum.UserInputType.Keyboard then
                        Keybind.Value = input.KeyCode
                        KeyBtn.Text = input.KeyCode.Name
                        binding = false
                        callback(input.KeyCode)
                    end
                end)

                return Keybind
            end

            -- ColorPicker (New! - Simple version)
            function Section:AddColorPicker(text, default, callback)
                default = default or Color3.fromRGB(255, 255, 255)
                local Picker = {Value = default}
                local PickFrame = Instance.new("Frame")
                PickFrame.Size = UDim2.new(1, 0, 0, 35)
                PickFrame.BackgroundTransparency = 1
                PickFrame.Parent = SecContent

                local PickLabel = Instance.new("TextLabel")
                PickLabel.Size = UDim2.new(1, -60, 1, 0)
                PickLabel.Position = UDim2.new(0, 10, 0, 0)
                PickLabel.BackgroundTransparency = 1
                PickLabel.Text = text
                PickLabel.TextColor3 = Theme.Text
                PickLabel.Font = Enum.Font.Arial
                PickLabel.TextSize = 14
                PickLabel.TextXAlignment = Enum.TextXAlignment.Left
                PickLabel.Parent = PickFrame

                local PickPreview = Instance.new("Frame")
                PickPreview.Size = UDim2.new(0, 50, 0, 25)
                PickPreview.Position = UDim2.new(1, -60, 0.5, -12)
                PickPreview.BackgroundColor3 = default
                PickPreview.Parent = PickFrame
                CreateCorner(PickPreview, 6)
                CreateStroke(PickPreview)

                -- Picker UI (expand when clicked)
                local PickCanvas = Instance.new("Frame")
                PickCanvas.Size = UDim2.new(0, 0, 0, 0)
                PickCanvas.Position = UDim2.new(0, 0, 1, 5)
                PickCanvas.BackgroundColor3 = Theme.Secondary
                PickCanvas.Visible = false
                PickCanvas.Parent = PickFrame
                CreateCorner(PickCanvas, 10)
                CreateStroke(PickCanvas)

                -- Add simple color selection (for demo, can expand)
                PickPreview.MouseButton1Click:Connect(function()
                    PickCanvas.Visible = not PickCanvas.Visible
                    Tween(PickCanvas, {Size = PickCanvas.Visible and UDim2.new(1, 0, 0, 150) or UDim2.new(0, 0, 0, 0)})
                    -- Add color sliders here if needed
                end)

                -- Callback example (fake for now)
                callback(default)
                return Picker
            end

            -- TextBox (New!)
            function Section:AddTextbox(text, default, callback)
                default = default or ""
                local Textbox = {Value = default}
                local TxtFrame = Instance.new("Frame")
                TxtFrame.Size = UDim2.new(1, 0, 0, 35)
                TxtFrame.BackgroundTransparency = 1
                TxtFrame.Parent = SecContent

                local TxtLabel = Instance.new("TextLabel")
                TxtLabel.Size = UDim2.new(0.5, 0, 1, 0)
                TxtLabel.Position = UDim2.new(0, 10, 0, 0)
                TxtLabel.BackgroundTransparency = 1
                TxtLabel.Text = text
                TxtLabel.TextColor3 = Theme.Text
                TxtLabel.Font = Enum.Font.Arial
                TxtLabel.TextSize = 14
                TxtLabel.TextXAlignment = Enum.TextXAlignment.Left
                TxtLabel.Parent = TxtFrame

                local TxtInput = Instance.new("TextBox")
                TxtInput.Size = UDim2.new(0.5, -20, 1, -6)
                TxtInput.Position = UDim2.new(0.5, 10, 0.5, -12)
                TxtInput.BackgroundColor3 = Theme.Primary
                TxtInput.Text = default
                TxtInput.TextColor3 = Theme.Accent
                TxtInput.Font = Enum.Font.Arial
                TxtInput.TextSize = 14
                TxtInput.Parent = TxtFrame
                CreateCorner(TxtInput, 8)
                CreateStroke(TxtInput)

                TxtInput.FocusLost:Connect(function(enter)
                    if enter then
                        Textbox.Value = TxtInput.Text
                        callback(TxtInput.Text)
                    end
                end)
                return Textbox
            end

            return Section
        end

        return Tab
    end

    return Window
end

-- Toggle with Insert
UserInputService.InputBegan:Connect(function(input, gp)
    if not gp and input.KeyCode == Enum.KeyCode.Insert then
        ScreenGui.Enabled = not ScreenGui.Enabled
    end
end)

-- Notify (Improved, stackable)
local NotifyContainer = Instance.new("Frame")
NotifyContainer.Size = UDim2.new(0, 300, 1, 0)
NotifyContainer.Position = UDim2.new(1, -320, 0, 0)
NotifyContainer.BackgroundTransparency = 1
NotifyContainer.Parent = ScreenGui

local NotifyLayout = Instance.new("UIListLayout")
NotifyLayout.SortOrder = Enum.SortOrder.LayoutOrder
NotifyLayout.Padding = UDim.new(0, 10)
NotifyLayout.VerticalAlignment = Enum.VerticalAlignment.Bottom
NotifyLayout.Parent = NotifyContainer

function Library:Notify(title, desc, dur)
    dur = dur or 4
    local Notif = Instance.new("Frame")
    Notif.Size = UDim2.new(1, 0, 0, 70)
    Notif.BackgroundColor3 = Theme.Secondary
    Notif.Parent = NotifyContainer
    CreateCorner(Notif, 10)
    CreateStroke(Notif, Theme.Accent)
    CreateGradient(Notif, Theme.Secondary, Theme.Primary)

    local NotifTitle = Instance.new("TextLabel")
    NotifTitle.Size = UDim2.new(1, -20, 0, 25)
    NotifTitle.Position = UDim2.new(0, 10, 0, 5)
    NotifTitle.Text = title
    NotifTitle.TextColor3 = Theme.Accent
    NotifTitle.Font = Enum.Font.ArialBold
    NotifTitle.TextSize = 16
    NotifTitle.Parent = Notif

    local NotifDesc = Instance.new("TextLabel")
    NotifDesc.Size = UDim2.new(1, -20, 0, 35)
    NotifDesc.Position = UDim2.new(0, 10, 0, 30)
    NotifDesc.Text = desc
    NotifDesc.TextColor3 = Theme.Text
    NotifDesc.Font = Enum.Font.Arial
    NotifDesc.TextSize = 13
    NotifDesc.TextWrapped = true
    NotifDesc.Parent = Notif

    Tween(Notif, {Position = UDim2.new(0, -20, 0, 0)}, TweenInfo.new(0.4, Enum.EasingStyle.Back))
    wait(dur)
    Tween(Notif, {Position = UDim2.new(0, 320, 0, 0)}, TweenInfo.new(0.4, Enum.EasingStyle.Quart))
    wait(0.4)
    Notif:Destroy()
end

return Library
